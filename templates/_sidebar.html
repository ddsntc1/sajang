<div class="sidebar-custom">
    <div class="nav flex-column">
        {% if category or current_type %}
        {% if request.session.last_visited_type %}
        <!-- 최근 방문한 카테고리 타입의 게시판 목록 -->
        <h6 class="sidebar-heading d-flex align-items-center fw-bold text-uppercase text-muted small mb-3 px-3">
            {% if request.session.last_visited_type == 'board' %}
            <i class="fas fa-list me-2"></i>커뮤니티
            {% elif request.session.last_visited_type == 'story' %}
            <i class="fas fa-book me-2"></i>이야기 게시판
            {% elif request.session.last_visited_type == 'advertise' %}
            <i class="fas fa-ad me-2"></i>광고 게시판
            {% endif %}
        </h6>
        <div class="nav flex-column mb-4">
            {% for cat in categories %}
            {% if cat.type == request.session.last_visited_type %}
            <a class="sidebar-link {% if current_category == cat.slug %}active fw-bold{% endif %}"
                href="{% url 'board:category_questions' cat.slug %}">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <span class="text-truncate me-2">{{ cat.name }}</span>
                    <small
                        class="badge-custom flex-shrink-0 {% if current_category == cat.slug %}bg-primary text-white{% else %}bg-light text-muted{% endif %}">
                        {% if cat.slug != 'all' %}
                        {{ cat.questions.count }}
                        {% else %}
                        {{board_Q_count}}
                        {% endif %}
                    </small>
                </div>
            </a>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        {% else %}

        <!-- 기본: 커뮤니티 목록 -->
        <h6 class="sidebar-heading d-flex align-items-center fw-bold text-uppercase text-muted small mb-3 px-3">
            <i class="fas fa-list me-2"></i>커뮤니티
        </h6>
        <div class="nav flex-column mb-4">
            {% for cat in board_categories %}
            <a class="sidebar-link" href="{% url 'board:category_questions' cat.slug %}">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <span class="text-truncate me-2">{{ cat.name }}</span>
                    <small class="badge-custom bg-light text-muted flex-shrink-0">
                        {% if cat.slug != 'all' %}
                        {{ cat.questions.count }}
                        {% else %}
                        {{board_Q_count}}
                        {% endif %}
                    </small>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <hr class="my-3 opacity-25">

        {% if user.is_authenticated %}
        <a href="{% url 'common:delete_account' %}" class="sidebar-link text-danger"
            onclick="return confirm('정말로 회원탈퇴 페이지로 이동하시겠습니까?');">
            <i class="fas fa-user-times me-2"></i>회원탈퇴
        </a>

        <a href="{% url 'common:logout' %}" class="sidebar-link">
            <i class="fas fa-sign-out-alt me-2"></i>로그아웃
        </a>
        {% else %}
        <a href="{% url 'common:login' %}" class="sidebar-link">
            <i class="fas fa-sign-in-alt me-2"></i>로그인
        </a>
        {% endif %}
    </div>
</div>