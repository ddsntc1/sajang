{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-custom py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6 col-xl-5">
            <div class="text-center mb-4">
                <h2 class="fw-bold text-primary">나도사장</h2>
                <p class="text-muted">함께 성장하는 사장님들의 커뮤니티</p>
            </div>

            <div class="card-custom p-4 p-md-5 shadow-sm">
                <h4 class="fw-bold mb-4 text-center">회원가입</h4>

                <form method="post" class="post-form">
                    {% csrf_token %}
                    {% include "form_errors.html" %}

                    <div class="mb-3">
                        <label for="username" class="form-label fw-bold small text-muted">닉네임</label>
                        <input type="text" name="username" id="username" class="form-control form-control-custom"
                            value="{{form.username.value|default_if_none:''}}" placeholder="커뮤니티에서 사용할 닉네임" required>
                    </div>

                    <div class="mb-3">
                        <label for="user_id" class="form-label fw-bold small text-muted">아이디</label>
                        <input type="text" name="user_id" id="user_id" class="form-control form-control-custom"
                            value="{{form.user_id.value|default_if_none:''}}" placeholder="로그인에 사용할 아이디" required>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="password1" class="form-label fw-bold small text-muted">비밀번호</label>
                            <input type="password" name="password1" id="password1"
                                class="form-control form-control-custom"
                                value="{{form.password1.value|default_if_none:''}}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="password2" class="form-label fw-bold small text-muted">비밀번호 확인</label>
                            <input type="password" name="password2" id="password2"
                                class="form-control form-control-custom"
                                value="{{form.password2.value|default_if_none:''}}" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label fw-bold small text-muted">이메일</label>
                        <input type="email" name="email" id="email" class="form-control form-control-custom"
                            value="{{form.email.value|default_if_none:''}}" placeholder="example@email.com" required>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="category" class="form-label fw-bold small text-muted">사업 분야</label>
                            <select name="category" id="category" class="form-select form-select-custom">
                                <option value="">분야를 선택해주세요</option>
                                {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="business_type" class="form-label fw-bold small text-muted">세부 업종</label>
                            <select name="business_type" id="business_type" class="form-select form-select-custom"
                                disabled>
                                <option value="">사업 분야를 선택해주세요</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="business_name" class="form-label fw-bold small text-muted">사업장 이름 <span
                                class="fw-normal text-muted">(선택)</span></label>
                        <input type="text" name="business_name" id="business_name"
                            class="form-control form-control-custom"
                            value="{{form.business_name.value|default_if_none:''}}" placeholder="운영중인 사업장 이름">
                    </div>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" value="on" id="terms_agree" name="terms_agree" {% if form.terms_agree.value %}checked{% endif %} required>
                        <label class="form-check-label small text-muted" for="terms_agree">
                            <strong>이용약관</strong>에 동의합니다.
                        </label>
                    </div>

                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" value="on" id="privacy_agree" name="privacy_agree" {% if form.privacy_agree.value %}checked{% endif %} required>
                        <label class="form-check-label small text-muted" for="privacy_agree">
                            <strong>개인정보 처리방침</strong>에 동의합니다.
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary-custom w-100 py-2 mb-3 fw-bold shadow-sm">회원가입
                        완료</button>
                </form>

                <div class="text-center mt-3">
                    <p class="small text-muted mb-2">이미 계정이 있으신가요?</p>
                    <a href="{% url 'common:login' %}" class="text-primary fw-bold text-decoration-none">로그인하기</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('category').addEventListener('change', function () {
        const categoryId = this.value;
        const businessTypeSelect = document.getElementById('business_type');

        if (!categoryId) {
            businessTypeSelect.disabled = true;
            businessTypeSelect.innerHTML = '<option value="">먼저 사업 분야를 선택해주세요</option>';
            return;
        }

        // AJAX로 해당 카테고리의 business_type 목록을 가져옴
        fetch(`/common/get_business_types/${categoryId}/`)
            .then(response => response.json())
            .then(data => {
                businessTypeSelect.disabled = false;
                businessTypeSelect.innerHTML = '<option value="">업종을 선택해주세요</option>';
                data.forEach(type => {
                    businessTypeSelect.innerHTML += `<option value="${type.id}">${type.name}</option>`;
                });
            });
    });
</script>

<style>
    .form-select-custom {
        border-radius: 0.5rem;
        border: 1px solid var(--border-color);
        padding: 0.75rem 1rem;
    }

    .form-select-custom:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.25);
    }
</style>
{% endblock %}
