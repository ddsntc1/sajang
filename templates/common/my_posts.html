{% extends 'base.html' %}
{% load board_filter %}

{% block content %}
<div class="container my-4">
    <h4 class="border-bottom pb-2 mb-4">내 활동</h4>

    <div id="myPostsWrapper">
        {% include 'common/partials/_my_posts_section.html' %}
    </div>
</div>
{% endblock %}

{% block script %}
<style>
#myPostsWrapper.loading {
    opacity: 0.6;
    pointer-events: none;
}
</style>
<script>
(function() {
    const wrapper = document.getElementById('myPostsWrapper');
    if (!wrapper) return;

    const fetchSection = (url) => {
        wrapper.classList.add('loading');
        fetch(url, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
            .then((res) => {
                if (!res.ok) throw new Error('Failed to load content');
                return res.text();
            })
            .then((html) => {
                wrapper.innerHTML = html;
                window.history.replaceState({}, '', url);
                window.scrollTo({ top: wrapper.offsetTop - 60, behavior: 'smooth' });
            })
            .catch(() => {
                alert('새로고침 후 다시 시도해주세요.');
            })
            .finally(() => {
                wrapper.classList.remove('loading');
            });
    };

    document.addEventListener('click', (event) => {
        const link = event.target.closest('a.js-my-posts-link');
        if (!link) return;
        event.preventDefault();
        fetchSection(link.href);
    });
})();
</script>
{% endblock %}
